{"id":"I1du","dependencies":[{"name":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js.map","includedInParent":true,"mtime":1613521243129},{"name":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/src/ops/log_softmax.ts","includedInParent":true,"mtime":1613521243129},{"name":"/Users/linazhao/tf/models/body-pix/demos/package.json","includedInParent":true,"mtime":1613671076017},{"name":"/Users/linazhao/tf/models/body-pix/demos/.babelrc","includedInParent":true,"mtime":1608229350283},{"name":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/package.json","includedInParent":true,"mtime":1613521243129},{"name":"../gradients","loc":{"line":17,"column":27},"parent":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js","resolved":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/gradients.js"},{"name":"../tensor_util_env","loc":{"line":18,"column":32},"parent":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js","resolved":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/tensor_util_env.js"},{"name":"./cast","loc":{"line":19,"column":21},"parent":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js","resolved":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/cast.js"},{"name":"./exp","loc":{"line":20,"column":20},"parent":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js","resolved":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/exp.js"},{"name":"./log","loc":{"line":21,"column":20},"parent":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js","resolved":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log.js"},{"name":"./max","loc":{"line":22,"column":20},"parent":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js","resolved":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/max.js"},{"name":"./mul","loc":{"line":23,"column":20},"parent":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js","resolved":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/mul.js"},{"name":"./operation","loc":{"line":24,"column":19},"parent":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js","resolved":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/operation.js"},{"name":"./sub","loc":{"line":25,"column":20},"parent":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js","resolved":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/sub.js"},{"name":"./sum","loc":{"line":26,"column":20},"parent":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/log_softmax.js","resolved":"/Users/linazhao/tf/models/body-pix/demos/node_modules/@tensorflow/tfjs-core/dist/ops/sum.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.logSoftmax=void 0;var r=require(\"../gradients\"),e=require(\"../tensor_util_env\"),o=require(\"./cast\"),t=require(\"./exp\"),s=require(\"./log\"),u=require(\"./max\"),a=require(\"./mul\"),n=require(\"./operation\"),i=require(\"./sub\"),l=require(\"./sum\");function m(n,m=-1){const x=(0,e.convertToTensor)(n,\"logits\",\"logSoftmax\");if(-1===m&&(m=x.rank-1),m!==x.rank-1)throw Error(\"Log Softmax along a non-last dimension is not yet supported. \"+`Logits was rank ${x.rank} and axis was ${m}`);return(0,r.customGrad)((r,e)=>{const n=(0,u.max)(r,m,!0),x=(0,i.sub)(r,n),c=(0,i.sub)((0,o.cast)(x,\"float32\"),(0,s.log)((0,l.sum)((0,t.exp)(x),m,!0)));e([c]);return{value:c,gradFunc:(r,e)=>{const[o]=e,s=(0,t.exp)(o);return(0,i.sub)(r,(0,a.mul)((0,l.sum)(r,m,!0),s))}}})(x)}const x=(0,n.op)({logSoftmax_:m});exports.logSoftmax=x;"},"sourceMaps":{"js":{"mappings":[{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":0}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":13}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":20}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":35}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":43}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":56}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":57}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":64}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":68}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":76}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":92}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":1,"column":94}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":1,"column":98}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":1,"column":100}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":1,"column":108}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":22,"column":0},"generated":{"line":1,"column":124}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":22,"column":0},"generated":{"line":1,"column":126}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":22,"column":0},"generated":{"line":1,"column":134}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":156}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":158}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":25,"column":0},"generated":{"line":1,"column":166}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":26,"column":0},"generated":{"line":1,"column":176}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":26,"column":0},"generated":{"line":1,"column":178}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":26,"column":0},"generated":{"line":1,"column":186}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":27,"column":0},"generated":{"line":1,"column":195}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":27,"column":0},"generated":{"line":1,"column":197}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":27,"column":0},"generated":{"line":1,"column":205}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":28,"column":0},"generated":{"line":1,"column":214}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":28,"column":0},"generated":{"line":1,"column":216}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":28,"column":0},"generated":{"line":1,"column":224}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":1,"column":233}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":1,"column":235}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":1,"column":243}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":1,"column":252}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":1,"column":254}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":30,"column":0},"generated":{"line":1,"column":262}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":31,"column":0},"generated":{"line":1,"column":277}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":31,"column":0},"generated":{"line":1,"column":279}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":31,"column":0},"generated":{"line":1,"column":287}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":1,"column":296}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":1,"column":298}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":32,"column":0},"generated":{"line":1,"column":306}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":55,"column":0},"generated":{"line":1,"column":315}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":55,"column":9},"generated":{"line":1,"column":324}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":55,"column":39},"generated":{"line":1,"column":326}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":55,"column":61},"generated":{"line":1,"column":328}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":55,"column":68},"generated":{"line":1,"column":331}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":56,"column":8},"generated":{"line":1,"column":334}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":56,"column":8},"generated":{"line":1,"column":340}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":56,"column":18},"generated":{"line":1,"column":343}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":56,"column":34},"generated":{"line":1,"column":345}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":56,"column":34},"generated":{"line":1,"column":347}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":56,"column":34},"generated":{"line":1,"column":364}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":56,"column":42},"generated":{"line":1,"column":366}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":56,"column":52},"generated":{"line":1,"column":375}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":61,"column":6},"generated":{"line":1,"column":389}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":58,"column":16},"generated":{"line":1,"column":393}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":58,"column":6},"generated":{"line":1,"column":397}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":59,"column":4},"generated":{"line":1,"column":401}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":59,"column":11},"generated":{"line":1,"column":403}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":59,"column":19},"generated":{"line":1,"column":405}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":59,"column":26},"generated":{"line":1,"column":410}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":61,"column":6},"generated":{"line":1,"column":413}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":61,"column":15},"generated":{"line":1,"column":417}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":61,"column":23},"generated":{"line":1,"column":419}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":61,"column":30},"generated":{"line":1,"column":424}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":62,"column":10},"generated":{"line":1,"column":426}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":62,"column":10},"generated":{"line":1,"column":432}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":63,"column":8},"generated":{"line":1,"column":438}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":64,"column":27},"generated":{"line":1,"column":521}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":64,"column":35},"generated":{"line":1,"column":523}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":64,"column":56},"generated":{"line":1,"column":544}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":96,"column":9},"generated":{"line":1,"column":549}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":79,"column":19},"generated":{"line":1,"column":556}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":79,"column":30},"generated":{"line":1,"column":558}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":79,"column":30},"generated":{"line":1,"column":560}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":79,"column":30},"generated":{"line":1,"column":572}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":79,"column":31},"generated":{"line":1,"column":573}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":79,"column":47},"generated":{"line":1,"column":575}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":80,"column":10},"generated":{"line":1,"column":580}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":81,"column":10},"generated":{"line":1,"column":586}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":81,"column":17},"generated":{"line":1,"column":589}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":81,"column":21},"generated":{"line":1,"column":591}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":81,"column":21},"generated":{"line":1,"column":593}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":81,"column":21},"generated":{"line":1,"column":598}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":81,"column":29},"generated":{"line":1,"column":600}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":81,"column":35},"generated":{"line":1,"column":603}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":82,"column":10},"generated":{"line":1,"column":606}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":82,"column":20},"generated":{"line":1,"column":609}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":82,"column":24},"generated":{"line":1,"column":611}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":82,"column":24},"generated":{"line":1,"column":613}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":82,"column":24},"generated":{"line":1,"column":618}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":82,"column":32},"generated":{"line":1,"column":620}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":83,"column":10},"generated":{"line":1,"column":623}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":8},"generated":{"line":1,"column":626}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":12},"generated":{"line":1,"column":628}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":12},"generated":{"line":1,"column":630}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":12},"generated":{"line":1,"column":636}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":17},"generated":{"line":1,"column":638}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":17},"generated":{"line":1,"column":640}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":17},"generated":{"line":1,"column":646}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":26},"generated":{"line":1,"column":648}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":38},"generated":{"line":1,"column":660}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":42},"generated":{"line":1,"column":662}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":42},"generated":{"line":1,"column":664}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":42},"generated":{"line":1,"column":670}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":46},"generated":{"line":1,"column":672}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":46},"generated":{"line":1,"column":674}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":46},"generated":{"line":1,"column":680}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":50},"generated":{"line":1,"column":682}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":50},"generated":{"line":1,"column":684}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":50},"generated":{"line":1,"column":689}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":84,"column":60},"generated":{"line":1,"column":692}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":80,"column":21},"generated":{"line":1,"column":695}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":85,"column":4},"generated":{"line":1,"column":700}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":85,"column":9},"generated":{"line":1,"column":702}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":85,"column":10},"generated":{"line":1,"column":703}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":93,"column":11},"generated":{"line":1,"column":707}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":93,"column":11},"generated":{"line":1,"column":713}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":93,"column":12},"generated":{"line":1,"column":714}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":93,"column":12},"generated":{"line":1,"column":720}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":93,"column":19},"generated":{"line":1,"column":722}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":87,"column":21},"generated":{"line":1,"column":731}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":87,"column":22},"generated":{"line":1,"column":732}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":87,"column":34},"generated":{"line":1,"column":734}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":88,"column":12},"generated":{"line":1,"column":739}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":88,"column":13},"generated":{"line":1,"column":745}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":88,"column":22},"generated":{"line":1,"column":748}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":90,"column":12},"generated":{"line":1,"column":750}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":90,"column":22},"generated":{"line":1,"column":753}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":90,"column":26},"generated":{"line":1,"column":755}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":90,"column":26},"generated":{"line":1,"column":757}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":90,"column":26},"generated":{"line":1,"column":762}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":13},"generated":{"line":1,"column":765}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":13},"generated":{"line":1,"column":772}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":17},"generated":{"line":1,"column":774}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":17},"generated":{"line":1,"column":776}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":17},"generated":{"line":1,"column":781}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":21},"generated":{"line":1,"column":784}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":25},"generated":{"line":1,"column":786}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":25},"generated":{"line":1,"column":788}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":25},"generated":{"line":1,"column":794}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":29},"generated":{"line":1,"column":796}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":29},"generated":{"line":1,"column":798}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":29},"generated":{"line":1,"column":803}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":33},"generated":{"line":1,"column":805}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":89,"column":23},"generated":{"line":1,"column":808}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":91,"column":50},"generated":{"line":1,"column":811}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":96,"column":9},"generated":{"line":1,"column":818}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":96,"column":18},"generated":{"line":1,"column":819}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":822}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":13},"generated":{"line":1,"column":828}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":26},"generated":{"line":1,"column":831}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":29},"generated":{"line":1,"column":833}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":29},"generated":{"line":1,"column":835}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":29},"generated":{"line":1,"column":839}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":30},"generated":{"line":1,"column":840}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":30},"generated":{"line":1,"column":852}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":856}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":864}},{"source":"../../src/ops/log_softmax.ts","name":null,"original":{"line":106,"column":7},"generated":{"line":1,"column":875}}],"sources":{"../../src/ops/log_softmax.ts":"/**\n * @license\n * Copyright 2020 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {customGrad} from '../gradients';\n\nimport {Tensor} from '../tensor';\nimport {GradSaveFunc} from '../tensor_types';\nimport {convertToTensor} from '../tensor_util_env';\nimport {TensorLike} from '../types';\n\nimport {cast} from './cast';\nimport {exp} from './exp';\nimport {log} from './log';\nimport {max} from './max';\nimport {mul} from './mul';\nimport {op} from './operation';\nimport {sub} from './sub';\nimport {sum} from './sum';\n\n/**\n * Computes the log softmax.\n *\n * ```js\n * const a = tf.tensor1d([1, 2, 3]);\n *\n * a.logSoftmax().print();  // or tf.logSoftmax(a)\n * ```\n *\n * ```js\n * const a = tf.tensor2d([2, 4, 6, 1, 2, 3], [2, 3]);\n *\n * a.logSoftmax().print();  // or tf.logSoftmax(a)\n * ```\n *\n * @param logits The logits array.\n * @param axis The dimension softmax would be performed on. Defaults to `-1`\n *     which indicates the last dimension.\n *\n * @doc {heading: 'Operations', subheading: 'Normalization'}\n */\nfunction logSoftmax_<T extends Tensor>(logits: T|TensorLike, axis = -1): T {\n  const $logits = convertToTensor(logits, 'logits', 'logSoftmax');\n\n  if (axis === -1) {\n    axis = $logits.rank - 1;\n  }\n  if (axis !== $logits.rank - 1) {\n    throw Error(\n        'Log Softmax along a non-last dimension is not yet supported. ' +\n        `Logits was rank ${$logits.rank} and axis was ${axis}`);\n  }\n\n  // const forward: ForwardFunc<Tensor> = (backend, save) => {\n  //   const keepDims = true;\n  //   const xMax = max(logits, axis, true);\n  //   const shifted = sub(logits, xMax);\n  //   const value =\n  //       sub(cast(shifted, 'float32'), log(sum(exp(shifted), axis,\n  //       keepDims)));\n  //   save([value]);\n  //   return value;\n  // };\n\n  // Use a custom gradient for numerical stability.\n  const customOp = customGrad((logits: Tensor, save: GradSaveFunc) => {\n    const keepDims = true;\n    const xMax = max(logits, axis, true);\n    const shifted = sub(logits, xMax);\n    const value =\n        sub(cast(shifted, 'float32'), log(sum(exp(shifted), axis, keepDims)));\n    save([value]);\n\n    const gradFunc = (dy: Tensor, saved: Tensor[]) => {\n      const [value] = saved;\n      const keepDims = true;\n      const softmax = exp(value);\n      return sub(dy, mul(sum(dy, axis, keepDims), softmax));\n    };\n    return {value, gradFunc};\n  });\n\n  return customOp($logits) as T;\n\n  // TODO Use Engine.runKernel when CPU/WebGL/WASM backends implement this.\n  // const inputs: LogSoftmaxInputs = {logits: $logits};\n  // const attrs: LogSoftmaxAttrs = {axis};\n  // return ENGINE.runKernel(\n  //            LogSoftmax, inputs as {} as NamedTensorMap,\n  //            attrs as {} as NamedAttrMap);\n}\n\nexport const logSoftmax = op({logSoftmax_});\n"},"lineCount":null}},"error":null,"hash":"21f524e1a3ae2873d046a838e00c482c","cacheData":{"env":{}}}